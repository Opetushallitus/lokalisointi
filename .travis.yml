git:
  depth: false
branches:
  only:
    - master
language: java
jdk:
- openjdk8
services:
- docker
cache:
  directories:
  - $HOME/.m2
env:
  global:
  # AWS_ACCESS_KEY_ID
  - secure: "i71SzRAtE44mqeh5ivIZyG+M2v7IbKxcm4wqrOi6NXPQ20Y9hONbJrigcnOERaxB+I3sG59D2G2DgVNM8+BqMF4wE8ItUUyGgi/i6IcBwN/UDumRI9/WjLZgGfklkSeW13YYOLrD0kxHKkXglsCO8TVa2cLR+0uwBkmnMoUZ/PsZgJqpTZ1eJL2f9LnRxGmGlSlvv24WuXbwjr2FpOCcDSSHs0FR5W1m2RaCUEIn6xyTM2jx9BAmNxsiT+Cp6poAvTXhA5WYTiYYssFAxUCHGJUva4g1GavLwGi/rpsrGZSEHyYjXF87kl26gSZwA7Q7RdA7HRLJSHBc8FYJwNH3mHFjnNX8ybfd0mCpEyXJUI7YLEjALGY6wMBdAoZm9h88ly3XiQ4mXeO6xieGa4qIcc8jBl7bn8QDn83oMYUI9ve83h15/2E6w0KxhkTjcsyQUNB7NXDlzqTu1JZ4/hFjaiD+EiOeGJ5fJNU/skfHbVJjn/uT8QPeiEJD3BFXqgrr3nFJhF98gwiy/MLJ9Y/a13PxPdI5DIHgctObe15c+w8eoQIibK6rwgEwSmSXUTNP98rb0m9M8OguUKfzErS8E1NmQlaO+v7Gtz4eR+MfgHaNZJ2B+WedxTb/DKkA6sjFTHnsuH6ntJfOuIMQM4Wy4RPhMe/O0vsgUm6efcqSlJw="
    # AWS_SECRET_ACCESS_KEY
  - secure: "O5aHiPtoACocp9f2HXdR029Dwa6EfYBSdm9IQgnCFCIFYsrzJOTVG6di+MgmFNxk0QGIO/CBB9MuWkYls8KWM3UBKP1mT39YPdtBebkd8GaIVwx2/F259MkRtctVP1D/7k58JThxmIBCmX2EZL5Y7nHIRWEyVIEE1uqilv+lgZ0zzL8buk8pgQsSzGLuKK9MS8swRff1Oxkacvcfc5kyKuz9Vnnwdv7c/XGWPSOVGSzm8YjmErABUCs5t7DMcM4g8YN3VeYtGEp2n6PkMClRTauVM9xgcawfOg2/1FHilSnsp+2Uro19XrqdAPdqCwZxTw7t6a4ck00GQSCyh0uDK59UrKDidD0ZNGlFw1e4IHtPL4CmJUB0wKcgo0VPgOYZUsE1Kz9/7fnx5P0vg9uIaG4AWZOYQ6azqPm+dT34iDEIx8cDNmlMigowZ051By9kEaiLwQA54BJia2l1kUoasHMeYErtJAQtvK+6cYl2TFUIJIPwT/Vl+244qKU2GmS8bHAvZQ40sq6Apyu9ypuTPLUh7M9sHuVAzfGqP46Wrt6+RcgKxviqhngzUPegWq1A/77MQ2g8i2rzaGbJCYT7b/BOb3KIoK29fWuJ3E0WUL5X+S33qkpmlIWsP6A17Pn/Uol8vofv+aU6Tf3y49gfiYa1HnqdJroTirzUbedBy+w="

install:
- git clone https://github.com/Opetushallitus/ci-tools.git
- source ci-tools/common/setup-tools.sh
- export ARTIFACT_NAME="lokalisointi"

script:
- mvn clean package -B -Dbranch=${TRAVIS_BRANCH} -Drevision=${TRAVIS_COMMIT} -DbuildNumber=${TRAVIS_BUILD_NUMBER}

- mv lokalisointi/target/lokalisointi-*.war $DOCKER_BUILD_DIR/artifact/${ARTIFACT_NAME}.war
- cp -vr src/main/resources/oph-configuration $DOCKER_BUILD_DIR/config/

- export BASE_IMAGE="baseimage-war-openjdk8:master"
- ./ci-tools/common/pull-image.sh
- ./ci-tools/build/build-war.sh $ARTIFACT_NAME

deploy:
  provider: script
  script: ./ci-tools/build/upload-image.sh $ARTIFACT_NAME
  on:
    all_branches: true
